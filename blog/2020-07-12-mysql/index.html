<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>MySQL Index Data Structure Analysis</title><meta name="description" content="Java Backend Engineer specializing in Spring Boot, distributed systems, and microservices. Explore my projects, technical blog, and expertise."><meta name="keywords" content="Java, Spring Boot, Backend Developer, Microservices, Distributed Systems, MySQL, Redis, Docker, Kubernetes"><meta name="author" content="Weiguang Li"><meta name="robots" content="index, follow"><link rel="canonical" href="https://oipunk.github.io"><!-- Open Graph --><meta property="og:type" content="website"><meta property="og:url" content="https://oipunk.github.io"><meta property="og:title" content="MySQL Index Data Structure Analysis"><meta property="og:description" content="Java Backend Engineer specializing in Spring Boot, distributed systems, and microservices. Explore my projects, technical blog, and expertise."><meta property="og:image" content="https://oipunk.github.io/img/og-image.jpg"><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="MySQL Index Data Structure Analysis"><meta name="twitter:description" content="Java Backend Engineer specializing in Spring Boot, distributed systems, and microservices. Explore my projects, technical blog, and expertise."><meta name="twitter:image" content="https://oipunk.github.io/img/og-image.jpg"><link rel="shortcut icon" type="image/x-icon" href="/img/favicon.png"><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&family=Inter:wght@300;400;700;900&display=swap" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"><!-- Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-DNX03VZHBX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-DNX03VZHBX');
    </script><link rel="stylesheet" href="/_astro/about.Bxf0nmK-.css"></head> <body class="bg-gray-950 text-gray-100 font-sans"> <header class="sticky top-0 z-50 bg-gray-950/95 backdrop-blur-sm border-b border-gray-800" x-data="{ open: false, scrolled: false }" @scroll.window="scrolled = window.scrollY > 50"> <nav class="max-w-6xl mx-auto px-6 lg:px-12 py-6 flex items-center justify-between"> <a href="/" class="flex items-center gap-2 "> <i class="fas fa-code text-green-400 text-2xl led-glow"></i> <span class="text-xl font-bold font-code text-white">Weiguang Li</span> </a> <div class="hidden md:flex items-center gap-10 main-nav"> <a href="/about" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  ">  About </a><a href="/projects" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  ">  Projects </a><a href="/services" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  ">  Expertise </a><a href="/blog" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  ">  Blog </a><a href="/contact" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  ">  Contact </a> </div> <div class="md:hidden"> <button @click="open = !open" class="text-gray-300 hover:text-green-400 transition-colors"> <i x-show="!open" style="display: none;" class="fas fa-bars text-2xl"></i> <i x-show="open" class="fas fa-times text-2xl"></i> </button> <div x-show="open" style="display: none;" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 -translate-y-2" x-transition:enter-end="opacity-100 translate-y-0" x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100 translate-y-0" x-transition:leave-end="opacity-0 -translate-y-2" class="absolute top-full left-0 right-0 bg-gray-950 border-b border-gray-800 p-6 flex flex-col gap-4 shadow-lg"> <a href="/about" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  " x-on:click="open = false">  About </a><a href="/projects" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  " x-on:click="open = false">  Projects </a><a href="/services" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  " x-on:click="open = false">  Expertise </a><a href="/blog" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  " x-on:click="open = false">  Blog </a><a href="/contact" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  " x-on:click="open = false">  Contact </a> </div> </div> </nav> </header> <main id="main" class="relative bg-gray-900/50 overflow-hidden">  <section class="py-12 max-w-6xl mx-auto px-6 lg:px-12 relative z-10"> <div class="mb-8"> <h1 class="text-3xl lg:text-4xl font-bold font-code text-white mb-2"> <span class="text-white ">MySQL Index </span><span class="text-green-500 ">Data Structure </span><span class="text-white ">Analysis</span> </h1> <div class="flex items-center gap-4 text-gray-400"> <i class="fas fa-calendar-alt"></i> <span>July 12, 2020</span> <span>|</span> <span>20 min read</span> </div> </div> <div class="py-8 px-6 bg-gray-950 rounded-lg border border-gray-800 mb-8"> <div class="relative mb-8"> <img src="/img/blog3.jpg" alt="MySQL Index Data Structure Analysis" class="w-full object-cover rounded-lg border border-gray-800"> </div> <div class="post-content text-gray-300 space-y-8"><p><h2>二叉树、B-Tree、B+Tree、红黑树、平衡二叉树（AVL Trees）</h2></p><p><h3>平衡二叉树 (AVL Trees)</h3></p><p>  平衡二叉树是一种特殊的二叉树-所以他也满足前面说到的二叉树的两个特性-同时还有一个特性：</p><p>​ 它的左右两个子树的高度差的绝对值不超过1-并且左右两个子树都是一棵平衡二叉树。</p><p>  大家也看到了前面[35 27 48 12 29 38 55]插入完成后的图-其实就已经是一颗平衡二叉树。</p><p>  那如果按照[12 27 29 35 38 48 55]的顺序插入一颗平衡二叉树-会怎么样呢？我们看看插入以及平衡的过程：</p><p><img src="http://cdn.17coding.info/WeChat%20Screenshot_20190616165744.png" alt="illustration" class="my-4" /> <img src="http://cdn.17coding.info/WeChat%20Screenshot_20190616165806.png" alt="illustration" class="my-4" /> !<a href="MySQL索引数据结构分析/WeChat Screenshot_20190616165835.png">img</a> !<a href="MySQL索引数据结构分析/WeChat Screenshot_20190616165909.png">img</a> !<a href="MySQL索引数据结构分析/WeChat Screenshot_20190616165924.png">img</a> !<a href="MySQL索引数据结构分析/WeChat Screenshot_20190616165936.png">img</a> !<a href="MySQL索引数据结构分析/WeChat Screenshot_20190616165954.png">img</a></p><p>  这棵树始终满足平衡二叉树的几个特性而保持平衡！这样我们的树也不会退化为线性链表了！我们需要查找一个数的时候就能沿着树根一直往下找-这样的查找效率和二分法查找是一样的呢！</p><p>  一颗平衡二叉树能容纳多少的结点呢？这跟树的高度是有关系的-假设树的高度为h-那每一层最多容纳的结点数量为2^(n-1)-整棵树最多容纳节点数为2^0+2^1+2^2+…+2^(h-1)。这样计算-100w数据树的高度大概在20左右-那也就是说从有着100w条数据的平衡二叉树中找一个数据-最坏的情况下需要20次查找。如果是内存操作-效率也是很高的！但是我们数据库中的数据基本都是放在磁盘中的-每读取一个二叉树的结点就是一次磁盘IO-这样我们找一条数据如果要经过20次磁盘的IO？那性能就成了一个很大的问题了！那我们是不是可以把这棵树压缩一下-让每一层能够容纳更多的节点呢？虽然我矮-但是我胖啊…</p><p><h3>B-Tree</h3></p><p>  这颗矮胖的树就是B-Tree-注意中间是杠精的杠而不是减-所以也不要读成B减Tree了~</p><p>  那B-Tree有哪些特性呢？一棵m阶的B-Tree有如下特性：</p><p>> 1、每个结点最多m个子结点。  
> 2、除了根结点和叶子结点外-每个结点最少有m/2（向上取整）个子结点。  
> 3、如果根结点不是叶子结点-那根结点至少包含两个子结点。  
> 4、所有的叶子结点都位于同一层。  
> 5、每个结点都包含k个元素（关键字）-这里m/2≤k<m-这里m/2向下取整。  
> 6、每个节点中的元素（关键字）从小到大排列。  
> 7、每个元素（关键字）字左结点的值-都小于或等于该元素（关键字）。右结点的值都大于或等于该元素（关键字）。</p><p>  是不是感觉跟丈母娘张口问你要彩礼一样-列一堆的条件-而且每一条都让你很懵逼！下面我们以一个[0,1,2,3,4,5,6,7]的数组插入一颗3阶的B-Tree为例-将所有的条件都串起来-你就明白了！</p><p>!<a href="MySQL索引数据结构分析/WeChat Screenshot_20190619204220.png">img</a>  
!<a href="MySQL索引数据结构分析/WeChat Screenshot_20190619204227.png">img</a>  
!<a href="MySQL索引数据结构分析/WeChat Screenshot_20190619204243.png">img</a>  
!<a href="MySQL索引数据结构分析/WeChat Screenshot_20190619204302.png">img</a>  
!<a href="MySQL索引数据结构分析/WeChat Screenshot_20190619204311.png">img</a>  
!<a href="MySQL索引数据结构分析/WeChat Screenshot_20190619204327.png">img</a>  
!<a href="MySQL索引数据结构分析/WeChat Screenshot_20190619204336.png">img</a></p><p>  那么-你是否对B-Tree的几点特性都清晰了呢？在二叉树中-每个结点只有一个元素。但是在B-Tree中-每个结点都可能包含多个元素-并且非叶子结点在元素的左右都有指向子结点的指针。</p><p>  如果需要查找一个元素-那流程是怎么样的呢？我们看下图-如果我们要在下面的B-Tree中找到关键字24-那流程如下  
!<a href="MySQL索引数据结构分析/WeChat Screenshot_20190619210818.png">img</a>  
!<a href="MySQL索引数据结构分析/WeChat Screenshot_20190619210824.png">img</a>  
!<a href="MySQL索引数据结构分析/WeChat Screenshot_20190619210831.png">img</a>  
!<a href="MySQL索引数据结构分析/WeChat Screenshot_20190619210838.png">img</a></p><p>  从这个流程我们能看出-B-Tree的查询效率好像也并不比平衡二叉树高。但是查询所经过的结点数量要少很多-也就意味着要少很多次的磁盘IO-这对  
性能的提升是很大的。</p><p>  前面对B-Tree操作的图我们能看出来-元素就是类似1、2、3这样的数值-但是数据库的数据都是一条条的数据-如果某个数据库以B-Tree的数据结构存储数据-那数据怎么存放的呢？我们看下一张图</p><p>!<a href="MySQL索引数据结构分析/WeChat Screenshot_20190620221029.png">img</a></p><p>  普通的B-Tree的结点中-元素就是一个个的数字。但是上图中-我们把元素部分拆分成了key-data的形式-key就是数据的主键-data就是具体的数据。这样我们在找一条数的时候-就沿着根结点往下找就ok了-效率是比较高的。</p><p><h3>B+Tree</h3></p><p>  B+Tree是在B-Tree基础上的一种优化-使其更适合实现外存储索引结构。B+Tree与B-Tree的结构很像-但是也有几个自己的特性：</p><p>> 1、所有的非叶子节点只存储关键字信息。  
> 2、所有卫星数据（具体数据）都存在叶子结点中。  
> 3、所有的叶子结点中包含了全部元素的信息。  
> 4、所有叶子节点之间都有一个链指针。</p><p>  如果上面B-Tree的图变成B+Tree-那应该如下：  
!<a href="MySQL索引数据结构分析/WeChat Screenshot_20190621220003.png">img</a></p><p>  大家仔细对比于B-Tree的图能发现什么不同？  
  1、非叶子结点上已经只有key信息了-满足上面第1点特性！  
  2、所有叶子结点下面都有一个data区域-满足上面第2点特性！  
  3、非叶子结点的数据在叶子结点上都能找到-如根结点的元素4、8在最底层的叶子结点上也能找到-满足上面第3点特性！  
  4、注意图中叶子结点之间的箭头-满足满足上面第4点特性！</p><p><h3>B-Tree or B+Tree？</h3></p><p>  在讲这两种数据结构在数据库中的选择之前-我们还需要了解的一个知识点是操作系统从磁盘读取数据到内存是以磁盘块（block）为基本单位的-<strong>位于同一个磁盘块中的数据会被一次性读取出来-而不是需要什么取什么</strong>。即使只需要一个字节-磁盘也会从这个位置开始-顺序向后读取一定长度的数据放入内存。这样做的理论依据是计算机科学中著名的<strong>局部性原理</strong>： 当一个数据被用到时-其附近的数据也通常会马上被使用。  
  预读的长度一般为页（page）的整倍数。页是计算机管理存储器的逻辑块-硬件及操作系统往往将主存和磁盘存储区分割为连续的大小相等的块-每个存储块称为一页（在许多操作系统中-页得大小通常为4k）。</p><p>  B-Tree和B+Tree该如何选择呢？都有哪些优劣呢？  
  1、B-Tree因为非叶子结点也保存具体数据-所以在查找某个关键字的时候找到即可返回。而B+Tree所有的数据都在叶子结点-每次查找都得到叶子结点。所以在同样高度的B-Tree和B+Tree中-B-Tree查找某个关键字的效率更高。  
  2、由于B+Tree所有的数据都在叶子结点-并且结点之间有指针连接-在找大于某个关键字或者小于某个关键字的数据的时候-B+Tree只需要找到该关键字然后沿着链表遍历就可以了-而B-Tree还需要遍历该关键字结点的根结点去搜索。  
  3、由于B-Tree的每个结点（这里的结点可以理解为一个数据页）都存储主键+实际数据-而B+Tree非叶子结点只存储关键字信息-而每个页的大小有限是有限的-所以同一页能存储的B-Tree的数据会比B+Tree存储的更少。这样同样总量的数据-B-Tree的深度会更大-增大查询时的磁盘I/O次数-进而影响查询效率。  
  鉴于以上的比较-所以在常用的关系型数据库中-都是选择B+Tree的数据结构来存储数据！下面我们以mysql的innodb存储引擎为例讲解-其他类似sqlserver、oracle的原理类似！</p><p>#### innodb引擎数据存储</p><p>  在InnoDB存储引擎中-也有页的概念-默认每个页的大小为16K-也就是每次读取数据时都是读取4*4k的大小！假设我们现在有一个用户表-我们往里面写数据</p><p>!<a href="MySQL索引数据结构分析/WeChat Screenshot_20190623130137.png">img</a></p><p>  这里需要注意的一点是-在某个页内插入新行时-为了不减少数据的移动-通常是插入到当前行的后面或者是已删除行留下来的空间-所以在<strong>某一个页内</strong>的数据并<strong>不是完全有序</strong>的（后面页结构部分有细讲）-但是为了为了数据访问顺序性-在每个记录中都有一个指向下一条记录的指针-以此构成了一条单向有序链表-不过在这里为了方便演示我是按顺序排列的！</p><p>  由于数据还比较少-一个页就能容下-所以只有一个根结点-主键和数据也都</div> </div> <div class="p-6 bg-gray-950 rounded-lg border border-gray-800 mb-8"> <div class="flex flex-col sm:flex-row items-center gap-6"> <img src="/img/male2.jpg" alt="Weiguang Li" class="w-16 h-16 rounded-full object-cover"> <div> <h4 class="max-sm:text-center text-lg font-bold text-white mb-1">Weiguang Li</h4> <p class="text-gray-300 mb-3">Java Backend Engineer specializing in Spring Boot, distributed systems, and microservices. Passionate about clean code and continuous learning.</p> <div class="flex gap-4"> <a href="https://github.com/OiPunk" target="_blank" class="text-gray-300 hover:text-green-400 text-xl"> <i class="fab fa-github"></i> </a> <a href="https://linkedin.com/in/" target="_blank" class="text-gray-300 hover:text-green-400 text-xl"> <i class="fab fa-linkedin"></i> </a> <a href="https://twitter.com/" target="_blank" class="text-gray-300 hover:text-green-400 text-xl"> <i class="fab fa-twitter"></i> </a> </div> </div> </div> </div> <div class="relative"> <h3 class="text-xl font-bold font-code text-white mb-6 flex items-center gap-2"> <i class="fas fa-book text-green-400 led-glow"></i> Related Articles
</h3> <div class="grid grid-cols-1 gap-6"> <a href="/blog/2020-06-13-mysql" class="bg-gray-950 rounded-lg border border-gray-800 flex flex-col md:flex-row gap-4 related-card overflow-hidden transition-transform"> <img src="/img/blog2.jpg" alt="MySQL Index Optimization Case Study" class="w-full md:w-1/4 object-cover"> <div class="p-6 flex-1"> <h4 class="text-lg font-bold font-code text-white mb-1">MySQL Index Optimization Case Study</h4> <p class="text-gray-300 text-sm">Real-world MySQL index optimization cases with execution plan analysis, covering index selection, composite indexes, and query tuning.</p> <div class="flex items-center gap-2 text-gray-400 text-sm mt-2"> <i class="fas fa-calendar-alt"></i> <span>June 13, 2020</span> </div> </div> </a><a href="/blog/2020-05-03-mysql" class="bg-gray-950 rounded-lg border border-gray-800 flex flex-col md:flex-row gap-4 related-card overflow-hidden transition-transform"> <img src="/img/blog2.jpg" alt="MySQL Transaction Test Cases" class="w-full md:w-1/4 object-cover"> <div class="p-6 flex-1"> <h4 class="text-lg font-bold font-code text-white mb-1">MySQL Transaction Test Cases</h4> <p class="text-gray-300 text-sm">Comprehensive test cases for MySQL transaction isolation levels covering dirty reads, non-repeatable reads, and phantom reads with practical SQL examples.</p> <div class="flex items-center gap-2 text-gray-400 text-sm mt-2"> <i class="fas fa-calendar-alt"></i> <span>May 3, 2020</span> </div> </div> </a> </div> </div> </section>  </main> <footer class="bg-dark py-16 relative overflow-hidden"> <div class="absolute inset-0 bg-hero opacity-[.03]"></div> <div class="max-w-6xl mx-auto px-6 lg:px-12 relative"> <div class="grid grid-cols-1 md:grid-cols-4 gap-12"> <div class="md:col-span-2 flex flex-col items-center md:items-start"> <a href="/" class="flex items-center gap-2 mb-4"> <i class="fas fa-code text-green-400 text-2xl led-glow"></i> <span class="text-xl font-bold font-code text-white">Weiguang Li</span> </a> <p class="text-gray-400 text-left lg:pe-16"> Java Backend Engineer specializing in Spring Boot, distributed systems, and microservices. Passionate about open source and continuous learning. </p> <div class="flex gap-4 mt-4"> <a href="https://github.com/OiPunk" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-green-400 transition-colors"> <i class="fab fa-github text-2xl"></i> </a> </div> </div> <div class="flex flex-col"> <h3 class="text-lg font-bold font-code text-white mb-4"><i class="fas fa-link text-green-400"></i> Quick Links</h3> <ul class="space-y-3"> <li> <a href="/about" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  text-gray-400 hover:text-green-400"> <i class="fa fa-user"></i> About </a> </li><li> <a href="/projects" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  text-gray-400 hover:text-green-400"> <i class="fa fa-code"></i> Projects </a> </li><li> <a href="/services" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  text-gray-400 hover:text-green-400"> <i class="fa fa-cogs"></i> Expertise </a> </li><li> <a href="/blog" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  text-gray-400 hover:text-green-400"> <i class="fa fa-blog"></i> Blog </a> </li><li> <a href="/contact" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  text-gray-400 hover:text-green-400"> <i class="fa fa-envelope"></i> Contact </a> </li> </ul> </div> <!-- Newsletter --> <div> <h3 class="text-xl font-bold font-code text-white mb-6 flex items-center gap-2"> <i class="fas fa-envelope text-green-400"></i> Newsletter </h3> <p class="text-gray-300 mb-4">Subscribe for the latest tech articles and project updates.</p> <form class="space-y-3"> <input type="email" placeholder="Enter your email" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-300 focus:outline-none focus:border-green-400 transition-colors"> <button type="submit" class="w-full px-4 py-2 bg-green-500 text-gray-900 font-bold rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center gap-2"> <i class="fas fa-paper-plane"></i> Subscribe </button> </form> </div> </div> <!-- Copyright --> <div class="mt-12 pt-8 border-t border-gray-800 flex flex-col md:flex-row justify-between items-center gap-4"> <p class="text-gray-300 text-sm">
© 2026 Weiguang Li. Crafted with  <i class="fas fa-heart text-green-400"></i> and  <i class="fas fa-coffee text-green-400"></i>.
</p> <div class="flex gap-6 text-gray-300 text-sm"> <a href="/privacy" class="hover:text-green-400 transition-colors">Privacy Policy</a><a href="/terms" class="hover:text-green-400 transition-colors">Terms of Service</a> </div> </div> </div> </footer> <button id="back-to-top" class="fixed bottom-6 end-6 bg-gray-800 border border-green-600 font-bold size-10 flex items-center justify-center rounded-full opacity-0 invisible transition-all duration-300 z-50" style="display: none;" title="Back to Top"> <svg class="size-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path> </svg> </button> <script type="module" src="/_astro/Layout.astro_astro_type_script_index_0_lang.B7yG3BKd.js"></script> </body> </html>
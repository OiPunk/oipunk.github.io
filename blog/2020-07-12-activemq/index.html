<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>ActiveMQ Deep Dive</title><meta name="description" content="Java Backend Engineer specializing in Spring Boot, distributed systems, and microservices. Explore my projects, technical blog, and expertise."><meta name="keywords" content="Java, Spring Boot, Backend Developer, Microservices, Distributed Systems, MySQL, Redis, Docker, Kubernetes"><meta name="author" content="Weiguang Li"><meta name="robots" content="index, follow"><link rel="canonical" href="https://oipunk.github.io"><!-- Open Graph --><meta property="og:type" content="website"><meta property="og:url" content="https://oipunk.github.io"><meta property="og:title" content="ActiveMQ Deep Dive"><meta property="og:description" content="Java Backend Engineer specializing in Spring Boot, distributed systems, and microservices. Explore my projects, technical blog, and expertise."><meta property="og:image" content="https://oipunk.github.io/img/og-image.jpg"><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="ActiveMQ Deep Dive"><meta name="twitter:description" content="Java Backend Engineer specializing in Spring Boot, distributed systems, and microservices. Explore my projects, technical blog, and expertise."><meta name="twitter:image" content="https://oipunk.github.io/img/og-image.jpg"><link rel="shortcut icon" type="image/x-icon" href="/img/favicon.png"><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&family=Inter:wght@300;400;700;900&display=swap" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"><!-- Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-DNX03VZHBX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-DNX03VZHBX');
    </script><link rel="stylesheet" href="/_astro/about.BWpmdKqS.css"></head> <body class="bg-gray-950 text-gray-100 font-sans"> <header class="sticky top-0 z-50 bg-gray-950/95 backdrop-blur-sm border-b border-gray-800" x-data="{ open: false, scrolled: false }" @scroll.window="scrolled = window.scrollY > 50"> <nav class="max-w-6xl mx-auto px-6 lg:px-12 py-6 flex items-center justify-between"> <a href="/" class="flex items-center gap-2 "> <i class="fas fa-code text-green-400 text-2xl led-glow"></i> <span class="text-xl font-bold font-code text-white">Weiguang Li</span> </a> <div class="hidden md:flex items-center gap-10 main-nav"> <a href="/about" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  ">  About </a><a href="/projects" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  ">  Projects </a><a href="/services" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  ">  Expertise </a><a href="/blog" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  ">  Blog </a><a href="/contact" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  ">  Contact </a> </div> <div class="md:hidden"> <button @click="open = !open" class="text-gray-300 hover:text-green-400 transition-colors"> <i x-show="!open" style="display: none;" class="fas fa-bars text-2xl"></i> <i x-show="open" class="fas fa-times text-2xl"></i> </button> <div x-show="open" style="display: none;" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 -translate-y-2" x-transition:enter-end="opacity-100 translate-y-0" x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100 translate-y-0" x-transition:leave-end="opacity-0 -translate-y-2" class="absolute top-full left-0 right-0 bg-gray-950 border-b border-gray-800 p-6 flex flex-col gap-4 shadow-lg"> <a href="/about" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  " x-on:click="open = false">  About </a><a href="/projects" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  " x-on:click="open = false">  Projects </a><a href="/services" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  " x-on:click="open = false">  Expertise </a><a href="/blog" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  " x-on:click="open = false">  Blog </a><a href="/contact" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  " x-on:click="open = false">  Contact </a> </div> </div> </nav> </header> <main id="main" class="relative bg-gray-900/50 overflow-hidden">  <section class="py-12 max-w-6xl mx-auto px-6 lg:px-12 relative z-10"> <div class="mb-8"> <h1 class="text-3xl lg:text-4xl font-bold font-code text-white mb-2"> <span class="text-white ">ActiveMQ Deep </span><span class="text-green-500 ">Dive</span> </h1> <div class="flex items-center gap-4 text-gray-400"> <i class="fas fa-calendar-alt"></i> <span>July 12, 2020</span> <span>|</span> <span>157 min read</span> </div> </div> <div class="py-8 px-6 bg-gray-950 rounded-lg border border-gray-800 mb-8"> <div class="relative mb-8"> <img src="/img/blog2.jpg" alt="ActiveMQ Deep Dive" class="w-full object-cover rounded-lg border border-gray-800"> </div> <div class="post-content text-gray-300 space-y-8"><p><h1>1. 详细介绍</h1></p><p><h2>什么是JMS MQ</h2></p><p>全称：Java MessageService 中文：Java 消息服务。</p><p>JMS 是 Java 的一套 API 标准-最初的目的是为了使应用程序能够访问现有的 MOM 系 统（MOM 是 MessageOriented Middleware 的英文缩写-指的是利用高效可靠的消息传递机 制进行平台无关的数据交流-并基于数据通信来进行分布式系统的集成。） ；</p><p>后来被许多现有 的 MOM 供应商采用-并实现为 MOM 系统。【常见 MOM 系统包括 Apache 的 ActiveMQ、 阿里巴巴的 RocketMQ、IBM 的 MQSeries、Microsoft 的 MSMQ、BEA 的 RabbitMQ 等。 （并 非全部的 MOM 系统都遵循 JMS 规范）】</p><p>基于 JMS 实现的 MOM-又被称为 JMSProvider。</p><p>“消息”是在两台计算机间传送的数据单位。消息可以非常简单-例如只包含文本字符串； 也可以更复杂-可能包含嵌入对象。 消息被发送到队列中。</p><p>“消息队列”是在消息的传输过程中保存消息的容器。消息队列管 理器在将消息从它的源中继到它的目标时充当中间人。</p><p>队列的主要目的是提供路由并保证消 息的传递；如果发送消息时接收者不可用-消息队列会保留消息-直到可以成功地传递它。</p><p>消息队列的主要特点是异步处理-主要目的是减少请求响应时间和解耦。所以主要的使 用场景就是将比较耗时而且不需要即时（同步）返回结果的操作作为消息放入消息队列。同 时由于使用了消息队列-只要保证消息格式不变-消息的发送方和接收方并不需要彼此联系- 也不需要受对方的影响-即解耦和。如: 跨系统的异步通信-所有需要异步交互的地方都可以使用消息队列。就像我们除了打电 话（同步）以外-还需要发短信-发电子邮件（异步）的通讯方式。 多个应用之间的耦合-由于消息是平台无关和语言无关的-而且语义上也不再是函数调 用-因此更适合作为多个应用之间的松耦合的接口。基于消息队列的耦合-不需要发送方和 接收方同时在线。 在企业应用集成（EAI）中-文件传输-共享数据库-消息队列-远程过程调用都可以 作为集成的方法。 应用内的同步变异步-比如订单处理-就可以由前端应用将订单信息放到队列-后端应 用从队列里依次获得消息处理-高峰时的大量订单可以积压在队列里慢慢处理掉。由于同步 通常意味着阻塞-而大量线程的阻塞会降低计算机的性能。 消息驱动的架构（EDA）-系统分解为消息队列-和消息制造者和消息消费者-一个处 理流程可以根据需要拆成多个阶段（Stage） -阶段之间用队列连接起来-前一个阶段处理的 结果放入队列-后一个阶段从队列中获取消息继续处理。 应用需要更灵活的耦合方式-如发布订阅-比如可以指定路由规则。 跨局域网-甚至跨城市的通讯-比如北京机房与广州机房的应用程序的通信。</p><p><h2>消息中间件应用场景</h2></p><p><h3><strong>异步通信</strong></h3></p><p>有些业务不想也不需要立即处理消息。消息队列提供了异步处理机制-允许用户把一个消息放入队列-但并不立即处理它。想向队列中放入多少消息就放多少-然后在需要的时候再去处理它们。</p><p><h3><strong>缓冲</strong></h3></p><p>在任何重要的系统中-都会有需要不同的处理时间的元素。消息队列通过一个缓冲层来帮助任务最高效率的执行-该缓冲有助于控制和优化数据流经过系统的速度。以调节系统响应时间。</p><p><h3><strong>解耦</strong></h3></p><p>降低工程间的强依赖程度-针对异构系统进行适配。在项目启动之初来预测将来项目会碰到什么需求-是极其困难的。通过消息系统在处理过程中间插入了一个隐含的、基于数据的接口层-两边的处理过程都要实现这一接口-当应用发生变化时-可以独立的扩展或修改两边的处理过程-只要确保它们遵守同样的接口约束。</p><p><h3><strong>冗余</strong></h3></p><p>有些情况下-处理数据的过程会失败。除非数据被持久化-否则将造成丢失。消息队列把数据进行持久化直到它们已经被完全处理-通过这一方式规避了数据丢失风险。许多消息队列所采用的”插入-获取-删除”范式中-在把一个消息从队列中删除之前-需要你的处理系统明确的指出该消息已经被处理完毕-从而确保你的数据被安全的保存直到你使用完毕。</p><p><h3><strong>扩展性</strong></h3></p><p>因为消息队列解耦了你的处理过程-所以增大消息入队和处理的频率是很容易的-只要另外增加处理过程即可。不需要改变代码、不需要调节参数。便于分布式扩容。</p><p><h3><strong>可恢复性</strong></h3></p><p>系统的一部分组件失效时-不会影响到整个系统。消息队列降低了进程间的耦合度-所以即使一个处理消息的进程挂掉-加入队列中的消息仍然可以在系统恢复后被处理。</p><p><h3><strong>顺序保证</strong></h3></p><p>在大多使用场景下-数据处理的顺序都很重要。大部分消息队列本来就是排序的-并且能保证数据会按照特定的顺序来处理。</p><p><h3><strong>过载保护</strong></h3></p><p>在访问量剧增的情况下-应用仍然需要继续发挥作用-但是这样的突发流量无法提取预知；如果以为了能处理这类瞬间峰值访问为标准来投入资源随时待命无疑是巨大的浪费。使用消息队列能够使关键组件顶住突发的访问压力-而不会因为突发的超负荷的请求而完全崩溃。</p><p><h3><strong>数据流处理</strong></h3></p><p>分布式系统产生的海量数据流-如：业务日志、监控数据、用户行为等-针对这些数据流进行实时或批量采集汇总-然后进行大数据分析是当前互联网的必备技术-通过消息队列完成此类数据收集是最好的选择。</p><p><h2>常用消息队列（ActiveMQ、RabbitMQ、RocketMQ、Kafka）比较</h2></p><p>特性MQ</p><p>ActiveMQ</p><p>RabbitMQ</p><p>RocketMQ</p><p>Kafka</p><p>生产者消费者模式</p><p>支持</p><p>支持</p><p>支持</p><p>支持</p><p>发布订阅模式</p><p>支持</p><p>支持</p><p>支持</p><p>支持</p><p>请求回应模式</p><p>支持</p><p>支持</p><p>不支持</p><p>不支持</p><p>Api完备性</p><p>高</p><p>高</p><p>高</p><p>高</p><p>多语言支持</p><p>支持</p><p>支持</p><p>java</p><p>支持</p><p>单机吞吐量</p><p>万级</p><p>万级</p><p>万级</p><p>十万级</p><p>消息延迟</p><p>无</p><p>微秒级</p><p>毫秒级</p><p>毫秒级</p><p>可用性</p><p>高（主从）</p><p>高（主从）</p><p>非常高（分布式）</p><p>非常高（分布式）</p><p>消息丢失</p><p>低</p><p>低</p><p>理论上不会丢失</p><p>理论上不会丢失</p><p>文档的完备性</p><p>高</p><p>高</p><p>高</p><p>高</p><p>提供快速入门</p><p>有</p><p>有</p><p>有</p><p>有</p><p>社区活跃度</p><p>高</p><p>高</p><p>有</p><p>高</p><p>商业支持</p><p>无</p><p>无</p><p>商业云</p><p>商业云</p><p><h2>JMS中的一些角色</h2></p><p><h3><strong>Broker</strong></h3></p><p>消息服务器-作为server提供消息核心服务</p><p><h3>provider</h3></p><p>生产者</p><p>消息生产者是由会话创建的一个对象-用于把消息发送到一个目的地。</p><p><h3>Consumer</h3></p><p>消费者</p><p>消息消费者是由会话创建的一个对象-它用于接收发送到目的地的消息。消息的消费可以采用以下两种方法之一：</p><p><li>同步消费。通过调用消费者的receive方法从目的地中显式提取消息。receive方法可以一直阻塞到消息到达。</li>
<li>异步消费。客户可以为消费者注册一个消息监听器-以定义在消息到达时所采取的动作。</li></p><p><h3>p2p</h3></p><p>基于点对点的消息模型</p><p>消息生产者生产消息发送到 queue 中-然后消息消费者从 queue 中取出并且消费消息。 消息被消费以后-queue 中不再有存储-所以消息消费者不可能消费到已经被消费的消  
息。  
Queue 支持存在多个消费者-但是对一个消息而言-只会有一个消费者可以消费、其它 的则不能消费此消息了。 当消费者不存在时-消息会一直保存-直到有消费消费</p><p><img src="/images/blog/image-20200110192535698.png" alt="illustration" class="my-4" /></p><p><h3>pub/sub</h3></p><p><img src="/images/blog/image-20200110192613518.png" alt="illustration" class="my-4" /></p><p>基于订阅/发布的消息模型</p><p>消息生产者（发布）将消息发布到 topic 中-同时有多个消息消费者（订阅）消费该消  
息。  
和点对点方式不同-发布到 topic 的消息会被所有订阅者消费。 当生产者发布消息-不管是否有消费者。都不会保存消息 一定要先有消息的消费者-后有消息的生产者。</p><p><h3>PTP 和 PUB/SUB 简单对</h3></p><p>1</p><p>Topic</p><p>Queue</p><p>Publish Subscribe messaging 发布 订阅消息</p><p>Point-to-Point 点对点</p><p>有无状态</p><p>topic 数据默认不落地-是无状态的。</p><p>Queue 数据默认会在 mq 服 务器上以文件形式保存-比如 Active MQ 一 般 保 存 在 $AMQ_HOME\data\kahadb 下 面。也可以配置成 DB 存储。</p><p>完整性保障</p><p>并不保证 publisher 发布的每条数 据-Subscriber 都能接受到。</p><p>Queue 保证每条数据都能 被 receiver 接收。消息不超时。</p><p>消息是否会丢失</p><p>一般来说 publisher 发布消息到某 一个 topic 时-只有正在监听该 topic 地址的 sub 能够接收到消息；如果没 有 sub 在监听-该 topic 就丢失了。</p><p>Sender 发 送 消 息 到 目 标 Queue- receiver 可以异步接收这 个 Queue 上的消息。Queue 上的 消息如果暂时没有 receiver 来 取-也不会丢失。前提是消息不 超时。</p><p>消息发布接 收策略</p><p>一对多的消息发布接收策略-监 听同一个topic地址的多个sub都能收 到 publisher 发送的消息。Sub 接收完 通知 mq 服务器</p><p>一</div> </div> <div class="p-6 bg-gray-950 rounded-lg border border-gray-800 mb-8"> <div class="flex flex-col sm:flex-row items-center gap-6"> <img src="/img/profile-avatar.png" alt="Weiguang Li" class="w-16 h-16 rounded-full object-cover"> <div> <h4 class="max-sm:text-center text-lg font-bold text-white mb-1">Weiguang Li</h4> <p class="text-gray-300 mb-3">Java Backend Engineer specializing in Spring Boot, distributed systems, and microservices. Passionate about clean code and continuous learning.</p> <div class="flex gap-4"> <a href="https://github.com/OiPunk" target="_blank" class="text-gray-300 hover:text-green-400 text-xl"> <i class="fab fa-github"></i> </a> <a href="https://linkedin.com/in/" target="_blank" class="text-gray-300 hover:text-green-400 text-xl"> <i class="fab fa-linkedin"></i> </a> <a href="https://twitter.com/" target="_blank" class="text-gray-300 hover:text-green-400 text-xl"> <i class="fab fa-twitter"></i> </a> </div> </div> </div> </div> <div class="relative"> <h3 class="text-xl font-bold font-code text-white mb-6 flex items-center gap-2"> <i class="fas fa-book text-green-400 led-glow"></i> Related Articles
</h3> <div class="grid grid-cols-1 gap-6"> <a href="/blog/2020-06-13" class="bg-gray-950 rounded-lg border border-gray-800 flex flex-col md:flex-row gap-4 related-card overflow-hidden transition-transform"> <img src="/img/blog3.jpg" alt="QuickSort Optimization: Dutch Flag &#38; Randomized Pivot" class="w-full md:w-1/4 object-cover"> <div class="p-6 flex-1"> <h4 class="text-lg font-bold font-code text-white mb-1">QuickSort Optimization: Dutch Flag &amp; Randomized Pivot</h4> <p class="text-gray-300 text-sm">In-depth technical analysis with code examples and enterprise best practices.</p> <div class="flex items-center gap-2 text-gray-400 text-sm mt-2"> <i class="fas fa-calendar-alt"></i> <span>June 13, 2020</span> </div> </div> </a><a href="/blog/2020-05-23-java" class="bg-gray-950 rounded-lg border border-gray-800 flex flex-col md:flex-row gap-4 related-card overflow-hidden transition-transform"> <img src="/img/blog5.jpg" alt="Java Concurrent Programming" class="w-full md:w-1/4 object-cover"> <div class="p-6 flex-1"> <h4 class="text-lg font-bold font-code text-white mb-1">Java Concurrent Programming</h4> <p class="text-gray-300 text-sm">Comprehensive guide to Java concurrency covering threads, synchronized, locks, concurrent collections, thread pools, and JUC utilities.</p> <div class="flex items-center gap-2 text-gray-400 text-sm mt-2"> <i class="fas fa-calendar-alt"></i> <span>May 23, 2020</span> </div> </div> </a> </div> </div> </section>  </main> <footer class="bg-dark py-16 relative overflow-hidden"> <div class="absolute inset-0 bg-hero opacity-[.03]"></div> <div class="max-w-6xl mx-auto px-6 lg:px-12 relative"> <div class="grid grid-cols-1 md:grid-cols-4 gap-12"> <div class="md:col-span-2 flex flex-col items-center md:items-start"> <a href="/" class="flex items-center gap-2 mb-4"> <i class="fas fa-code text-green-400 text-2xl led-glow"></i> <span class="text-xl font-bold font-code text-white">Weiguang Li</span> </a> <p class="text-gray-400 text-left lg:pe-16"> Java Backend Engineer specializing in Spring Boot, distributed systems, and microservices. Passionate about open source and continuous learning. </p> <div class="flex gap-4 mt-4"> <a href="https://github.com/OiPunk" target="_blank" rel="noopener noreferrer" class="text-gray-400 hover:text-green-400 transition-colors"> <i class="fab fa-github text-2xl"></i> </a> </div> </div> <div class="flex flex-col"> <h3 class="text-lg font-bold font-code text-white mb-4"><i class="fas fa-link text-green-400"></i> Quick Links</h3> <ul class="space-y-3"> <li> <a href="/about" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  text-gray-400 hover:text-green-400"> <i class="fa fa-user"></i> About </a> </li><li> <a href="/projects" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  text-gray-400 hover:text-green-400"> <i class="fa fa-code"></i> Projects </a> </li><li> <a href="/services" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  text-gray-400 hover:text-green-400"> <i class="fa fa-cogs"></i> Expertise </a> </li><li> <a href="/blog" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  text-gray-400 hover:text-green-400"> <i class="fa fa-blog"></i> Blog </a> </li><li> <a href="/contact" class="group relative text-gray-300 hover:text-green-400 transition-colors font-medium  text-gray-400 hover:text-green-400"> <i class="fa fa-envelope"></i> Contact </a> </li> </ul> </div> <!-- Newsletter --> <div> <h3 class="text-xl font-bold font-code text-white mb-6 flex items-center gap-2"> <i class="fas fa-envelope text-green-400"></i> Newsletter </h3> <p class="text-gray-300 mb-4">Subscribe for the latest tech articles and project updates.</p> <form class="space-y-3"> <input type="email" placeholder="Enter your email" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-300 focus:outline-none focus:border-green-400 transition-colors"> <button type="submit" class="w-full px-4 py-2 bg-green-500 text-gray-900 font-bold rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center gap-2"> <i class="fas fa-paper-plane"></i> Subscribe </button> </form> </div> </div> <!-- Copyright --> <div class="mt-12 pt-8 border-t border-gray-800 flex flex-col md:flex-row justify-between items-center gap-4"> <p class="text-gray-300 text-sm">
© 2026 Weiguang Li. Crafted with  <i class="fas fa-heart text-green-400"></i> and  <i class="fas fa-coffee text-green-400"></i>.
</p> <div class="flex gap-6 text-gray-300 text-sm"> <a href="/privacy" class="hover:text-green-400 transition-colors">Privacy Policy</a><a href="/terms" class="hover:text-green-400 transition-colors">Terms of Service</a> </div> </div> </div> </footer> <button id="back-to-top" class="fixed bottom-6 end-6 bg-gray-800 border border-green-600 font-bold size-10 flex items-center justify-center rounded-full opacity-0 invisible transition-all duration-300 z-50" style="display: none;" title="Back to Top"> <svg class="size-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path> </svg> </button> <script type="module" src="/_astro/Layout.astro_astro_type_script_index_0_lang.B7yG3BKd.js"></script> </body> </html>